<!DOCTYPE html><html class="default" lang="en" data-base="./"><head><meta charset="utf-8"/><meta http-equiv="x-ua-compatible" content="IE=edge"/><title>appointme</title><meta name="description" content="Documentation for appointme"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="assets/style.css"/><link rel="stylesheet" href="assets/highlight.css"/><script defer src="assets/main.js"></script><script async src="assets/icons.js" id="tsd-icons-script"></script><script async src="assets/search.js" id="tsd-search-script"></script><script async src="assets/navigation.js" id="tsd-nav-script"></script></head><body><script>document.documentElement.dataset.theme = localStorage.getItem("tsd-theme") || "os";document.body.style.display="none";setTimeout(() => window.app?app.showPage():document.body.style.removeProperty("display"),500)</script><header class="tsd-page-toolbar"><div class="tsd-toolbar-contents container"><a href="index.html" class="title">appointme</a><div id="tsd-toolbar-links"></div><button id="tsd-search-trigger" class="tsd-widget" aria-label="Search"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true"><use href="assets/icons.svg#icon-search"></use></svg></button><dialog id="tsd-search" aria-label="Search"><input role="combobox" id="tsd-search-input" aria-controls="tsd-search-results" aria-autocomplete="list" aria-expanded="true" autocapitalize="off" autocomplete="off" placeholder="Search the docs" maxLength="100"/><ul role="listbox" id="tsd-search-results"></ul><div id="tsd-search-status" aria-live="polite" aria-atomic="true"><div>Preparing search index...</div></div></dialog><a href="#" class="tsd-widget menu" id="tsd-toolbar-menu-trigger" data-toggle="menu" aria-label="Menu"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true"><use href="assets/icons.svg#icon-menu"></use></svg></a></div></header><div class="container container-main"><div class="col-content"><div class="tsd-page-title"><h1>appointme</h1></div><div class="tsd-panel tsd-typography"><p><a href="https://github.com/semantic-release/semantic-release"><img src="https://img.shields.io/badge/%20%20%F0%9F%93%A6%F0%9F%9A%80-semantic--release-e10079.svg" alt="semantic-release"></a>
<img src="https://img.shields.io/github/issues/fhswf/appointme" alt="GitHub issues">
<img src="https://img.shields.io/github/status/s/pulls/fhswf/appointme/10" alt="GitHub pull request check state">
<a href="https://sonarqube.fh-swf.cloud/dashboard?id=fhswf_appointme_4a6870c1-a6b0-4818-9a4f-c9256685c9d3"><img src="https://sonarqube.fh-swf.cloud/api/project_badges/measure?project=fhswf_appointme_4a6870c1-a6b0-4818-9a4f-c9256685c9d3&amp;metric=alert_status&amp;token=sqb_5deb3d670ea0a882f6563a07b9bea9dee035bcb6" alt="Quality Gate Status"></a></p>
<h1 id="appointment" class="tsd-anchor-link">APPointment<a href="#appointment" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h1>
<p>This web application helps you planning your appointments.</p>
<p>As a <em>provider</em> of appointments (i.e. consultation hours) you can manage times when you are available for different types of appointments
(online, in person, different durations) and integrate your Google calendar.</p>
<p>As a <em>client</em>, you can search for available slots and book an appointment. You will receive an invitation from the calendar service of the provider.</p>
<p>Full documentation is available at <a href="https://fhswf.github.io/appointme/">https://fhswf.github.io/appointme/</a>.</p>
<h2 id="deployment" class="tsd-anchor-link">Deployment<a href="#deployment" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2>
<h3 id="deployment-on-kubernetes" class="tsd-anchor-link">Deployment on Kubernetes<a href="#deployment-on-kubernetes" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3>
<p>To deploy the application on Kubernetes, you need to create the necessary ConfigMap and Secret resources.</p>
<ol>
<li>
<p><strong>Prepare Configuration:</strong>
Detailed configuration templates are provided in <code>backend/k8s/</code>.</p>
<ul>
<li><code>backend/k8s/configmap.yaml.example</code>: Use this as a template. Rename it to <code>configmap.yaml</code> (or create a new one). <strong>This is the central configuration for both backend and client.</strong>
<ul>
<li>Updates to <code>API_URL</code> and <code>BASE_URL</code> here will configure the Backend.</li>
<li>Updates to <code>REACT_APP_API_URL</code> and <code>REACT_APP_URL</code> here will be injected into the Client.</li>
<li>Set <code>MONGO_URI</code> and <code>CORS_ALLOWED_ORIGINS</code> as needed.</li>
</ul>
</li>
<li><code>backend/k8s/secret.yaml.example</code>: Use this as a template. Rename it to <code>secret.yaml</code> (or create a new one) and set sensitive secrets. <strong>Important:</strong> Replace the placeholder values (e.g., <code>changeme</code>) with your actual secrets before applying.</li>
</ul>
</li>
<li>
<p><strong>Apply Resources:</strong></p>
<pre><code class="bash"><span class="hl-0"># Example command (after creating the actual files)</span><br/><span class="hl-1">kubectl</span><span class="hl-2"> </span><span class="hl-3">apply</span><span class="hl-2"> </span><span class="hl-4">-f</span><span class="hl-2"> </span><span class="hl-3">backend/k8s/configmap.yaml</span><br/><span class="hl-1">kubectl</span><span class="hl-2"> </span><span class="hl-3">apply</span><span class="hl-2"> </span><span class="hl-4">-f</span><span class="hl-2"> </span><span class="hl-3">backend/k8s/secret.yaml</span>
</code><button type="button">Copy</button></pre>

</li>
<li>
<p><strong>Deploy Application:</strong></p>
<pre><code class="bash"><span class="hl-1">kubectl</span><span class="hl-2"> </span><span class="hl-3">apply</span><span class="hl-2"> </span><span class="hl-4">-f</span><span class="hl-2"> </span><span class="hl-3">backend/k8s/deployment.yaml</span>
</code><button type="button">Copy</button></pre>

</li>
<li>
<p><strong>Deploy MCP Server:</strong>
The MCP server is a separate deployment that integrates with the backend.</p>
<pre><code class="bash"><span class="hl-1">kubectl</span><span class="hl-2"> </span><span class="hl-3">apply</span><span class="hl-2"> </span><span class="hl-4">-k</span><span class="hl-2"> </span><span class="hl-3">mcp-server/k8s/base</span>
</code><button type="button">Copy</button></pre>

<p>The Ingress handles routing:</p>
<ul>
<li><code>/</code> -&gt; Client</li>
<li><code>/api</code> -&gt; Backend</li>
<li><code>/mcp</code> -&gt; MCP Server</li>
</ul>
</li>
</ol>
<h3 id="environment-overlays-stagingproduction" class="tsd-anchor-link">Environment Overlays (Staging/Production)<a href="#environment-overlays-stagingproduction" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3>
<p>You can manage multiple environments (e.g., Staging, Production) using Kustomize overlays located in <code>k8s/overlays/</code>.</p>
<ol>
<li>
<p><strong>Create an Overlay:</strong>
Copy an existing overlay (e.g., <code>k8s/overlays/dev</code>) to <code>k8s/overlays/staging</code> or <code>k8s/overlays/prod</code>.</p>
</li>
<li>
<p><strong>Customize <code>kustomization.yaml</code>:</strong></p>
<ul>
<li>Set the <code>namespace</code> for the environment.</li>
<li>Reference the base resources.</li>
<li>Add patches for <code>Ingress</code> (to set the correct host) and <code>ConfigMap</code> (see below).</li>
</ul>
</li>
<li>
<p><strong>Patch <code>ConfigMap</code>:</strong>
Create a <code>configmap-patch.yaml</code> in your overlay directory to override environment-specific values like module URLs.</p>
<pre><code class="yaml"><span class="hl-5">apiVersion</span><span class="hl-2">: </span><span class="hl-6">v1</span><br/><span class="hl-5">kind</span><span class="hl-2">: </span><span class="hl-6">ConfigMap</span><br/><span class="hl-5">metadata</span><span class="hl-2">:</span><br/><span class="hl-2">  </span><span class="hl-5">name</span><span class="hl-2">: </span><span class="hl-6">appointme</span><br/><span class="hl-5">data</span><span class="hl-2">:</span><br/><span class="hl-2">  </span><span class="hl-5">API_URL</span><span class="hl-2">: </span><span class="hl-3">&quot;https://staging.example.com/api/v1&quot;</span><br/><span class="hl-2">  </span><span class="hl-5">BASE_URL</span><span class="hl-2">: </span><span class="hl-3">&quot;https://staging.example.com&quot;</span><br/><span class="hl-2">  </span><span class="hl-5">REACT_APP_API_URL</span><span class="hl-2">: </span><span class="hl-3">&quot;https://staging.example.com/api/v1&quot;</span><br/><span class="hl-2">  </span><span class="hl-5">REACT_APP_URL</span><span class="hl-2">: </span><span class="hl-3">&quot;https://staging.example.com&quot;</span>
</code><button type="button">Copy</button></pre>

</li>
<li>
<p><strong>Deploy:</strong></p>
<pre><code class="bash"><span class="hl-1">kubectl</span><span class="hl-2"> </span><span class="hl-3">apply</span><span class="hl-2"> </span><span class="hl-4">-k</span><span class="hl-2"> </span><span class="hl-3">k8s/overlays/staging</span>
</code><button type="button">Copy</button></pre>

</li>
</ol>
<h3 id="deployment-with-argocd" class="tsd-anchor-link">Deployment with ArgoCD<a href="#deployment-with-argocd" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3>
<p>To deploy with ArgoCD, you can use the Application manifests provided in <code>k8s/argocd/</code>.</p>
<p>Example <code>k8s/argocd/prod.yaml</code>:</p>
<pre><code class="yaml"><span class="hl-5">apiVersion</span><span class="hl-2">: </span><span class="hl-6">argoproj.io/v1alpha1</span><br/><span class="hl-5">kind</span><span class="hl-2">: </span><span class="hl-6">Application</span><br/><span class="hl-5">metadata</span><span class="hl-2">:</span><br/><span class="hl-2">  </span><span class="hl-5">name</span><span class="hl-2">: </span><span class="hl-6">appointme-prod</span><br/><span class="hl-2">  </span><span class="hl-5">namespace</span><span class="hl-2">: </span><span class="hl-6">argocd</span><br/><span class="hl-5">spec</span><span class="hl-2">:</span><br/><span class="hl-2">  </span><span class="hl-5">project</span><span class="hl-2">: </span><span class="hl-6">default</span><br/><span class="hl-2">  </span><span class="hl-5">source</span><span class="hl-2">:</span><br/><span class="hl-2">    </span><span class="hl-5">repoURL</span><span class="hl-2">: </span><span class="hl-6">&#39;https://github.com/fhswf/appointme&#39;</span><br/><span class="hl-2">    </span><span class="hl-5">targetRevision</span><span class="hl-2">: </span><span class="hl-6">HEAD</span><br/><span class="hl-2">    </span><span class="hl-5">path</span><span class="hl-2">: </span><span class="hl-6">k8s/overlays/prod</span><br/><span class="hl-2">  </span><span class="hl-5">destination</span><span class="hl-2">:</span><br/><span class="hl-2">    </span><span class="hl-5">server</span><span class="hl-2">: </span><span class="hl-6">https://kubernetes.default.svc</span><br/><span class="hl-2">    </span><span class="hl-5">namespace</span><span class="hl-2">: </span><span class="hl-6">appointme-prod</span><br/><span class="hl-2">  </span><span class="hl-5">syncPolicy</span><span class="hl-2">:</span><br/><span class="hl-2">    </span><span class="hl-5">automated</span><span class="hl-2">: {}</span><br/><span class="hl-2">  </span><span class="hl-5">orphanedResources</span><span class="hl-2">:</span><br/><span class="hl-2">    </span><span class="hl-5">warn</span><span class="hl-2">: </span><span class="hl-4">true</span><span class="hl-2"> </span><span class="hl-0"># Warn about other unknown resources</span><br/><span class="hl-2">    </span><span class="hl-5">ignore</span><span class="hl-2">:</span><br/><span class="hl-2">      - </span><span class="hl-5">kind</span><span class="hl-2">: </span><span class="hl-6">Secret</span><br/><span class="hl-2">        </span><span class="hl-5">name</span><span class="hl-2">: </span><span class="hl-3">&quot;argocd-secret&quot;</span>
</code><button type="button">Copy</button></pre>

<h3 id="configuration" class="tsd-anchor-link">Configuration<a href="#configuration" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3>
<ul>
<li>provide details in <code>docker.env</code> and <code>.env</code></li>
</ul>
<h4 id="configuration-values" class="tsd-anchor-link">Configuration Values<a href="#configuration-values" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h4>
<table>
<thead>
<tr>
<th>Variable</th>
<th>Description</th>
<th>Required</th>
<th>Default</th>
<th>Source</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>MONGO_URI</code></td>
<td>Connection string for MongoDB</td>
<td>Yes</td>
<td></td>
<td>ConfigMap: <code>appointme</code></td>
</tr>
<tr>
<td><code>BASE_URL</code></td>
<td>URL of the frontend application (e.g., <code>https://example.com</code>)</td>
<td>Yes</td>
<td></td>
<td>ConfigMap: <code>appointme</code></td>
</tr>
<tr>
<td><code>API_URL</code></td>
<td>URL of the backend API (e.g., <code>https://api.example.com/api/v1</code>)</td>
<td>Yes</td>
<td></td>
<td>ConfigMap: <code>appointme</code></td>
</tr>
<tr>
<td><code>BASE_PATH</code></td>
<td>Base path of the application</td>
<td>No</td>
<td><code>/</code></td>
<td>ConfigMap: <code>appointme</code></td>
</tr>
<tr>
<td><code>DOMAIN</code></td>
<td>Domain for cookie scoping (e.g. <code>example.com</code>)</td>
<td>No</td>
<td></td>
<td>ConfigMap: <code>appointme</code> (implied)</td>
</tr>
<tr>
<td><code>JWT_SECRET</code></td>
<td>Secret key for signing JWTs</td>
<td>Yes</td>
<td></td>
<td>Secret: <code>appointme-secret</code></td>
</tr>
<tr>
<td><code>CSRF_SECRET</code></td>
<td>Secret key for CSRF protection</td>
<td>Yes</td>
<td></td>
<td>Secret: <code>appointme-secret</code></td>
</tr>
<tr>
<td><code>ADMIN_API_KEY</code></td>
<td>API Key for admin/cron operations</td>
<td>Yes</td>
<td></td>
<td>Secret: <code>appointme-secret</code></td>
</tr>
<tr>
<td><code>SENTRY_DSN</code></td>
<td>Sentry DSN for error tracking</td>
<td>No</td>
<td></td>
<td>Secret: <code>appointme-secret</code></td>
</tr>
<tr>
<td><code>CLIENT_ID</code></td>
<td>Google OAuth2 Client ID</td>
<td>No (if Google Login disabled)</td>
<td></td>
<td>Secret: <code>appointme-secret</code></td>
</tr>
<tr>
<td><code>CLIENT_SECRET</code></td>
<td>Google OAuth2 Client Secret</td>
<td>No (if Google Login disabled)</td>
<td></td>
<td>Secret: <code>appointme-secret</code></td>
</tr>
<tr>
<td><code>DISABLE_GOOGLE_LOGIN</code></td>
<td>Set to <code>true</code> to disable Google Login</td>
<td>No</td>
<td><code>false</code></td>
<td>ConfigMap: <code>appointme</code></td>
</tr>
<tr>
<td><code>OIDC_ISSUER</code></td>
<td>OIDC Provider URL (e.g., Keycloak Realm URL)</td>
<td>No (if OIDC disabled)</td>
<td></td>
<td>ConfigMap: <code>appointme</code></td>
</tr>
<tr>
<td><code>OIDC_CLIENT_ID</code></td>
<td>OIDC Client ID</td>
<td>No (if OIDC disabled)</td>
<td></td>
<td>ConfigMap: <code>appointme</code></td>
</tr>
<tr>
<td><code>OIDC_CLIENT_SECRET</code></td>
<td>OIDC Client Secret (for Confidential clients)</td>
<td>No</td>
<td></td>
<td>Secret: <code>appointme-secret</code></td>
</tr>
<tr>
<td><code>EMAIL_FROM</code></td>
<td>Email address for sending notifications</td>
<td>Yes</td>
<td></td>
<td>Secret: <code>appointme-secret</code></td>
</tr>
<tr>
<td><code>EMAIL_PASSWORD</code></td>
<td>Password for the email account</td>
<td>Yes</td>
<td></td>
<td>Secret: <code>appointme-secret</code></td>
</tr>
<tr>
<td><code>ENCRYPTION_KEY</code></td>
<td>32-byte hex key for encrypting CalDAV passwords</td>
<td>Yes</td>
<td></td>
<td>Secret: <code>appointme-secret</code></td>
</tr>
<tr>
<td><code>CONTACT_INFO</code></td>
<td>Contact information (Markdown supported)</td>
<td>No</td>
<td></td>
<td>ConfigMap: <code>appointme</code></td>
</tr>
<tr>
<td><code>REACT_APP_API_URL</code></td>
<td>Public API URL for the React Client</td>
<td>Yes</td>
<td></td>
<td>ConfigMap: <code>appointme</code></td>
</tr>
<tr>
<td><code>REACT_APP_URL</code></td>
<td>Public URL of the React Client</td>
<td>Yes</td>
<td></td>
<td>ConfigMap: <code>appointme</code></td>
</tr>
</tbody>
</table>
<h2 id="lti-integration" class="tsd-anchor-link">LTI Integration<a href="#lti-integration" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2>
<p>APPointment supports <strong>LTI 1.3</strong> (Learning Tools Interoperability) integration through <strong>OpenID Connect (OIDC)</strong>. This allows the application to be integrated into Learning Management Systems (LMS) like Moodle, Canvas, or other LTI-compliant platforms.</p>
<h3 id="how-it-works" class="tsd-anchor-link">How It Works<a href="#how-it-works" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3>
<p>The LTI integration is implemented using the standard OIDC authentication flow:</p>
<ol>
<li>
<p><strong>Authentication Flow</strong>:</p>
<ul>
<li>User clicks &quot;Login with OIDC&quot; in the application</li>
<li>Client fetches authorization URL from <code>/api/v1/oidc/url</code></li>
<li>User is redirected to the OIDC provider (e.g., Keycloak, LMS LTI endpoint)</li>
<li>After successful authentication, user is redirected back to <code>/oidc-callback</code> with authorization code</li>
<li>Client sends code to <code>/api/v1/oidc/login</code> endpoint</li>
<li>Backend exchanges code for tokens and retrieves user claims</li>
<li>User is created or updated in the database based on email</li>
<li>JWT token is issued and set as HTTP-only cookie</li>
</ul>
</li>
<li>
<p><strong>LTI Role Mapping</strong>:
The application automatically maps LTI roles from the OIDC claims to internal application roles:</p>
<ul>
<li>LTI roles are extracted from <code>https://purl.imsglobal.org/spec/lti/claim/roles</code> claim</li>
<li>Users with roles containing &quot;student&quot; or &quot;learner&quot; (case-insensitive) are assigned the <code>student</code> role</li>
<li>Additional role mappings can be extended in <a href="media/oidc_controller.ts"><code>oidc_controller.ts</code></a></li>
</ul>
</li>
<li>
<p><strong>User Creation</strong>:</p>
<ul>
<li>Users are identified by their <code>sub</code> (subject) claim from the OIDC token</li>
<li>User profile is created/updated with:
<ul>
<li>Email (required)</li>
<li>Name (from <code>name</code> claim or derived from email)</li>
<li>Profile picture (from <code>picture</code> claim, if provided)</li>
<li>Roles (mapped from LTI roles)</li>
</ul>
</li>
<li>User URL collisions are automatically handled with random suffixes</li>
</ul>
</li>
</ol>
<h3 id="configuration-1" class="tsd-anchor-link">Configuration<a href="#configuration-1" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3>
<p>To enable LTI/OIDC authentication, configure the following environment variables:</p>
<table>
<thead>
<tr>
<th>Variable</th>
<th>Description</th>
<th>Example</th>
<th>Source</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>OIDC_ISSUER</code></td>
<td>OIDC Provider/LTI Platform URL</td>
<td><code>https://keycloak.example.com/realms/myrealm</code></td>
<td>ConfigMap: <code>appointme</code></td>
</tr>
<tr>
<td><code>OIDC_CLIENT_ID</code></td>
<td>OIDC Client ID registered with the provider</td>
<td><code>appointme</code></td>
<td>ConfigMap: <code>appointme</code></td>
</tr>
<tr>
<td><code>OIDC_CLIENT_SECRET</code></td>
<td>Client Secret (for confidential clients)</td>
<td><code>your-secret-here</code></td>
<td>Secret: <code>appointme-secret</code></td>
</tr>
<tr>
<td><code>OIDC_NAME</code></td>
<td>Display name for the login button (optional)</td>
<td><code>Campus-ID</code></td>
<td>ConfigMap: <code>appointme</code></td>
</tr>
<tr>
<td><code>OIDC_ICON</code></td>
<td>Icon path for the login button (optional)</td>
<td><code>/fh-swf.svg</code></td>
<td>ConfigMap: <code>appointme</code></td>
</tr>
<tr>
<td><code>LTI_ISSUER</code></td>
<td>LTI Issuer URL (Overrides OIDC_ISSUER for LTI)</td>
<td><code>https://moodle.example.com</code></td>
<td>ConfigMap: <code>appointme</code></td>
</tr>
<tr>
<td><code>LTI_CLIENT_ID</code></td>
<td>LTI Client ID (Overrides OIDC_CLIENT_ID for LTI)</td>
<td><code>client-123</code></td>
<td>ConfigMap: <code>appointme</code></td>
</tr>
<tr>
<td><code>LTI_CLIENT_SECRET</code></td>
<td>LTI Client Secret (Overrides OIDC_CLIENT_SECRET)</td>
<td><code>secret-456</code></td>
<td>Secret (Implicit?)</td>
</tr>
<tr>
<td><code>LTI_AUTH_ENDPOINT</code></td>
<td>LTI Authorization Endpoint</td>
<td><code>https://moodle.example.com/mod/lti/auth.php</code></td>
<td>ConfigMap: <code>appointme</code></td>
</tr>
<tr>
<td><code>LTI_TOKEN_ENDPOINT</code></td>
<td>LTI Token Endpoint</td>
<td><code>https://moodle.example.com/mod/lti/token.php</code></td>
<td>ConfigMap: <code>appointme</code></td>
</tr>
<tr>
<td><code>LTI_JWKS_URI</code></td>
<td>LTI JWKS URI</td>
<td><code>https://moodle.example.com/mod/lti/certs.php</code></td>
<td>ConfigMap: <code>appointme</code></td>
</tr>
</tbody>
</table>
<h3 id="setting-up-with-keycloak" class="tsd-anchor-link">Setting Up with Keycloak<a href="#setting-up-with-keycloak" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3>
<ol>
<li>
<p>Create a new client in Keycloak:</p>
<ul>
<li>Client ID: Your desired client ID (e.g., <code>appointme</code>)</li>
<li>Client Protocol: <code>openid-connect</code></li>
<li>Access Type: <code>confidential</code> (if using client secret) or <code>public</code></li>
<li>Valid Redirect URIs: <code>https://your-domain.com/oidc-callback</code></li>
</ul>
</li>
<li>
<p>Configure LTI Claims (if using LTI):</p>
<ul>
<li>Ensure the client mapper includes <code>https://purl.imsglobal.org/spec/lti/claim/roles</code> in the ID token</li>
<li>Map user roles appropriately (e.g., Student, Instructor)</li>
</ul>
</li>
<li>
<p>Set environment variables in your deployment with the Keycloak realm URL and client credentials</p>
</li>
</ol>
<h3 id="setting-up-with-lms-moodlecanvas" class="tsd-anchor-link">Setting Up with LMS (Moodle/Canvas)<a href="#setting-up-with-lms-moodlecanvas" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3>
<p>Most modern LMS platforms support LTI 1.3 with OIDC. When configuring AppointMe as an External Tool (LTI 1.3), use the following settings:</p>
<p><strong>Moodle Tool Configuration:</strong></p>
<ul>
<li><strong>Tool URL</strong>: <code>[BASE_URL]</code> (e.g., <code>https://appointme.example.com</code>)</li>
<li><strong>LTI version</strong>: LTI 1.3</li>
<li><strong>Public key type</strong>: RSA Key
*   <em>AppointMe uses <code>client_secret_basic</code> authentication (Client ID + Client Secret) to communicate with the LMS. It DOES NOT sign requests with a private key (which is what <code>private_key_jwt</code> uses).</em>
*   <em>However, some LMS versions (like Moodle) may structurally require a Public Key to be present in the configuration form.</em>
*   <em>If required, you can generate a &quot;dummy&quot; key pair to satisfy the form:</em><pre><code class="bash"><span class="hl-1">openssl</span><span class="hl-2"> </span><span class="hl-3">genrsa</span><span class="hl-2"> </span><span class="hl-4">-out</span><span class="hl-2"> </span><span class="hl-3">private.key</span><span class="hl-2"> </span><span class="hl-7">2048</span><br/><span class="hl-1">openssl</span><span class="hl-2"> </span><span class="hl-3">rsa</span><span class="hl-2"> </span><span class="hl-4">-in</span><span class="hl-2"> </span><span class="hl-3">private.key</span><span class="hl-2"> </span><span class="hl-4">-pubout</span><span class="hl-2"> </span><span class="hl-4">-out</span><span class="hl-2"> </span><span class="hl-3">public.key</span>
</code><button type="button">Copy</button></pre>

</li>
</ul>
<pre><code>*   *Paste `public.key` into Moodle. AppointMe does NOT need the private key and will NOT use this key pair. It validates the JWTs sent BY Moodle using Moodle's own public keys (fetched automatically via the Issuer URL).*
</code></pre>
<ul>
<li><strong>Initiate login URL</strong>: <code>[API_URL]/api/v1/oidc/init</code> (e.g., <code>https://api.appointme.example.com/api/v1/oidc/init</code>)</li>
<li><strong>Redirection URI(s)</strong>: <code>[BASE_URL]/oidc-callback</code> (e.g., <code>https://appointme.example.com/oidc-callback</code>)</li>
<li><strong>Custom parameters</strong>: No custom parameters are required.
<ul>
<li><em>Roles are automatically mapped from <code>https://purl.imsglobal.org/spec/lti/claim/roles</code>.</em></li>
</ul>
</li>
</ul>
<p><strong>Environment Configuration (in AppointMe):</strong></p>
<ol>
<li>Set <code>OIDC_ISSUER</code> to the Platform ID / Issuer URL provided by Moodle (e.g., <code>https://moodle.example.com</code>).</li>
<li>Set <code>OIDC_CLIENT_ID</code> to the Client ID generated by Moodle.</li>
<li>Set <code>OIDC_CLIENT_SECRET</code> to the Client Secret provided by Moodle (or generate one if using specific plugins).</li>
</ol>
<h3 id="security-features" class="tsd-anchor-link">Security Features<a href="#security-features" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3>
<ul>
<li><strong>Rate Limiting</strong>:
<ul>
<li>Authorization URL endpoint: 100 requests per 15 minutes per IP</li>
<li>Login endpoint: 5 attempts per minute per IP</li>
</ul>
</li>
<li><strong>HTTP-only Cookies</strong>: JWT tokens are stored in secure, HTTP-only cookies</li>
<li><strong>Token Validation</strong>: All tokens are validated using the OIDC provider's public keys (JWKS)</li>
<li><strong>CORS Protection</strong>: Configurable allowed origins via <code>CORS_ALLOWED_ORIGINS</code></li>
</ul>
<h3 id="api-endpoints" class="tsd-anchor-link">API Endpoints<a href="#api-endpoints" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3>
<ul>
<li><code>GET /api/v1/oidc/config</code> - Check if OIDC is enabled</li>
<li><code>GET /api/v1/oidc/url</code> - Get authorization URL for authentication</li>
<li><code>POST /api/v1/oidc/login</code> - Complete authentication with authorization code</li>
</ul>
<h3 id="technical-implementation" class="tsd-anchor-link">Technical Implementation<a href="#technical-implementation" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3>
<p>The LTI/OIDC integration is implemented in:</p>
<ul>
<li>Backend controller: <a href="media/oidc_controller.ts"><code>backend/src/controller/oidc_controller.ts</code></a></li>
<li>Backend routes: <a href="media/oidc_routes.ts"><code>backend/src/routes/oidc_routes.ts</code></a></li>
<li>Client callback handler: <a href="media/OidcCallback.tsx"><code>client/src/pages/OidcCallback.tsx</code></a></li>
</ul>
<p>For detailed implementation, see the source code in the repository.</p>
</div></div><div class="col-sidebar"><div class="page-menu"><div class="tsd-navigation settings"><details class="tsd-accordion"><summary class="tsd-accordion-summary"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="assets/icons.svg#icon-chevronDown"></use></svg><h3>Settings</h3></summary><div class="tsd-accordion-details"><div class="tsd-filter-visibility"><span class="settings-label">Member Visibility</span><ul id="tsd-filter-options"><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-protected" name="protected"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Protected</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-inherited" name="inherited" checked/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Inherited</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-external" name="external"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>External</span></label></li></ul></div><div class="tsd-theme-toggle"><label class="settings-label" for="tsd-theme">Theme</label><select id="tsd-theme"><option value="os">OS</option><option value="light">Light</option><option value="dark">Dark</option></select></div></div></details></div><details open class="tsd-accordion tsd-page-navigation"><summary class="tsd-accordion-summary"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="assets/icons.svg#icon-chevronDown"></use></svg><h3>On This Page</h3></summary><div class="tsd-accordion-details"><a href="#appointment"><span>AP<wbr/>Pointment</span></a><ul><li><a href="#deployment"><span>Deployment</span></a></li><li><ul><li><a href="#deployment-on-kubernetes"><span>Deployment on <wbr/>Kubernetes</span></a></li><li><a href="#environment-overlays-stagingproduction"><span>Environment <wbr/>Overlays (<wbr/>Staging/<wbr/>Production)</span></a></li><li><a href="#deployment-with-argocd"><span>Deployment with <wbr/>Argo<wbr/>CD</span></a></li><li><a href="#configuration"><span>Configuration</span></a></li><li><ul><li><a href="#configuration-values"><span>Configuration <wbr/>Values</span></a></li></ul></li></ul></li><li><a href="#lti-integration"><span>LTI <wbr/>Integration</span></a></li><li><ul><li><a href="#how-it-works"><span>How <wbr/>It <wbr/>Works</span></a></li><li><a href="#configuration-1"><span>Configuration</span></a></li><li><a href="#setting-up-with-keycloak"><span>Setting <wbr/>Up with <wbr/>Keycloak</span></a></li><li><a href="#setting-up-with-lms-moodlecanvas"><span>Setting <wbr/>Up with <wbr/>LMS (<wbr/>Moodle/<wbr/>Canvas)</span></a></li><li><a href="#security-features"><span>Security <wbr/>Features</span></a></li><li><a href="#api-endpoints"><span>API <wbr/>Endpoints</span></a></li><li><a href="#technical-implementation"><span>Technical <wbr/>Implementation</span></a></li></ul></li></ul></div></details></div><div class="site-menu"><nav class="tsd-navigation"><a href="modules.html">appointme</a><ul class="tsd-small-nested-navigation" id="tsd-nav-container"><li>Loading...</li></ul></nav></div></div></div><footer><p class="tsd-generator">Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p></footer><div class="overlay"></div></body></html>
